{
  "name": "http_retry_orchestration",
  "version": "1.0.0",
  "taskId": "task-http-retry-001",
  "taskType": "retry",
  "priority": "normal",

  "goal": {
    "description": "Handle HTTP requests with intelligent retry logic, exponential backoff, and circuit breaker patterns",
    "target_conditions": [
      {
        "description": "Request completed or max retries exhausted",
        "evaluation_type": "GOAL_MET"
      },
      {
        "description": "Complete within 5 iterations",
        "evaluation_type": "ITERATION_LIMIT",
        "expected_value": "5"
      }
    ]
  },

  "resource_llm": {
    "provider": "anthropic",
    "model": "claude-3-haiku-20240307",
    "temperature": 0.0,
    "max_tokens": 256,
    "api_key_env": "ANTHROPIC_API_KEY"
  },

  "resource_registry": {
    "entries": [
      {
        "name": "retry_config",
        "category": "config",
        "description": "HTTP retry configuration",
        "data": {
          "retryable_status_codes": [408, 429, 500, 502, 503, 504],
          "max_retries": 3,
          "base_delay_ms": 1000,
          "max_delay_ms": 10000,
          "backoff_multiplier": 2
        }
      }
    ]
  },

  "input": {
    "method": "POST",
    "url": "https://api.example.com/endpoint",
    "status_code": 503,
    "attempt": 1,
    "error_message": "Service Unavailable"
  },

  "prompts": [
    {
      "template": "Evaluate HTTP response for retry eligibility:\n- Status code: {{status_code}}\n- Error: {{error_message}}\n- Current attempt: {{attempt}}\n- Retry config: {{registry:retry_config}}\n\nDetermine if request should be retried. Respond with category: 'retry' or 'fail' and include reason.",
      "role": "user",
      "description": "Check if retryable"
    },
    {
      "template": "Calculate backoff delay for retry:\n- Decision: {{response:P0}}\n- Current attempt: {{attempt}}\n- Config: {{registry:retry_config}}\n\nIf retry, calculate delay using exponential backoff: delay = min(base * (multiplier ^ attempt), max_delay)\n\nRespond with JSON: {\"should_retry\": bool, \"delay_ms\": number, \"next_attempt\": number, \"reason\": \"...\"}",
      "role": "user",
      "description": "Calculate backoff delay"
    }
  ],

  "flow_diagram": {
    "mermaid": "graph TD\n    START --> P0\n    P0 -->|retry| P1\n    P0 -->|fail| GOAL\n    P1 --> GOAL\n    GOAL -->|goal_met| END\n    GOAL -->|goal_failed| END"
  }
}
